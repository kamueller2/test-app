<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <script src="https://apis.google.com/js/api.js"></script>

    <title>Document</title>
</head>

<body>
    <!-- google login -->

    <section>
        <div id="firebaseui-auth-container">
            <div id="my-signin2"></div>
            <div id="loader"></div>
        </div>
    </section>


    <script>
        var provider = new firebase.auth.GoogleAuthProvider();
        var firebaseConfig = {
            apiKey: "AIzaSyBN7LY1mgo8xNyiqviHoMbxTnrT4whKLXM",
            authDomain: "project-1-b691a.firebaseapp.com",
            databaseURL: "https://project-1-b691a.firebaseio.com",
            projectId: "project-1-b691a",
            storageBucket: "project-1-b691a.appspot.com",
            messagingSenderId: "904494310957",
            appId: "1:904494310957:web:f844b97c354d9a11",

            clientId: "904494310957-snk9h5ndi37tl0h4emhho96llkpm10v7.apps.googleusercontent.com",
            api_key: 'AIzaSyBkCA6UT776r0tRv_oynJX5g4T8xZd7PIE',

            scopes: ["email", "profile",
                "https://www.googleapis.com/auth/calendar"
            ],

            discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"]
        };
        firebase.initializeApp(firebaseConfig);

        var database = firebase.database();
        const calendarEventsScope = 'https://www.googleapis.com/auth/calendar';

        provider.addScope(calendarEventsScope);



        // This function adds an access token to the google api client if available, otherwise it will ask you for your credentials again.
        function authenticateGoogleAPI() {
            return new Promise((resolve, reject) => {
                if (!accessToken) {
                    // Reentering the app as a logged in firebase user, we need to reauth to get a new access token.
                    firebaseUser.reauthenticateWithPopup(provider).then(result => {
                        console.log('reauthenticate result', result)
                        accessToken = result.credential.accessToken
                        gapi.client.setToken({
                            access_token: accessToken
                        })
                        resolve()
                    })
                } else {
                    // Already have access token from logging in
                    gapi.client.setToken({
                        access_token: accessToken
                    })
                    resolve()
                }
            })
        }
        /*
         * Google API
         * */
        function onGapiLoad() {
            // Enable the api you want to use in the developer console
            // https://console.developers.google.com/apis/library/
            function fetchData() {
                authenticateGoogleAPI()
                    .then(() => {
                        return gapi.client.request({
                            // Pick an endpoint based on the scope and api you defined.
                            path: 'https://www.googleapis.com/calendar/v3/calendars/primary/events',
                            method: 'GET'
                        })
                    })
                    .then(result => {
                        fetchResponse.innerText = result.body
                    })
            }
            gapi.client.init({
                'apiKey': 'AIzaSyBkCA6UT776r0tRv_oynJX5g4T8xZd7PIE',
                // clientId and scope are optional if auth is not required.
                'clientId': '904494310957-snk9h5ndi37tl0h4emhho96llkpm10v7.apps.googleusercontent.com',
                'scope': 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest',

            }).then(function() {
                // 3. Initialize and add an onClick handler to make the API request.
                console.log('google api initialized')
                fetchButton.addEventListener('click', fetchData)
            });
        }
        // 1. Load the JavaScript client library.
        gapi.load('client', onGapiLoad);
    </script>

</body>

</html>